<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.commerce.huayi.mapper.GoodsSpuMapper">
  <resultMap id="BaseResultMap" type="com.commerce.huayi.entity.db.GoodsSpu">
    <!--@mbg.generated generated on Mon Apr 08 15:02:40 CST 2019.-->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="spu_no" jdbcType="VARCHAR" property="spuNo" />
    <result column="goods_name" jdbcType="VARCHAR" property="goodsName" />
    <result column="goods_description" jdbcType="VARCHAR" property="goodsDescription" />
    <result column="goods_image_key" jdbcType="VARCHAR" property="goodsImageKey" />
    <result column="low_price" jdbcType="DECIMAL" property="lowPrice" />
    <result column="category_id" jdbcType="BIGINT" property="categoryId" />
    <result column="brand_id" jdbcType="BIGINT" property="brandId" />
    <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
    <result column="update_date" jdbcType="TIMESTAMP" property="updateDate" />
    <result column="is_delete" jdbcType="TINYINT" property="isDelete" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--@mbg.generated generated on Mon Apr 08 15:02:40 CST 2019.-->
    id, spu_no, goods_name, goods_description, goods_image_key, low_price, category_id, 
    brand_id, create_date, update_date, is_delete
  </sql>

  <select id="search" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List"/>
    from tb_goods_spu where goods_name like concat(concat('%',#{keyWord}),'%') or goods_description like
    concat(concat('%',#{keyWord}),'%')
  </select>

  <select id="searchBySql" resultType="java.util.Map" parameterType="java.util.Map">
    ${sqlStatement}
  </select>


  <select id="getGoodsByCategoryId" resultType="com.commerce.huayi.entity.response.GoodsSpuDetailsVo">
    SELECT spu.id,
           spu.spu_no            as spuNo,
           spu.goods_name        as goodsName,
           spu.goods_description as goodsDescription,
           spu.goods_image_key   as goodsImageKey,
           spu.low_price         as lowPrice,
           spu.brand_id          as brandId,
           category.id           as categoryId,
           spec.id               as specId,
           spec.spec_no          as specNo,
           spec.spec_name        as specName,
           spec.spec_description as specDescription,
           specValue.id          as specValueId,
           specValue.spec_value  as specValue
    FROM
         tb_goods_spu_spec tgss
           JOIN tb_goods_spu spu ON tgss.spu_id = spu.id
           JOIN tb_goods_spec_value specValue ON tgss.spec_value_id = specValue.id
           JOIN tb_goods_spec spec ON specValue.spec_id = spec.id
           JOIN tb_goods_category category ON spu.category_id = category.id
      WHERE 1=1
      and tgss.is_delete =0
      and spu.is_delete=0
      and specValue.is_delete =0
      and spec.is_delete =0
      and category.is_delete = 0
      <if test="categoryId != null and categoryId != 0">
          and category.id = #{categoryId}
      </if>
    order by specValue.id
    limit #{offset, jdbcType=INTEGER},#{rowSize, jdbcType=INTEGER}
  </select>

  <select id="getGoodsCountByCategoryId" resultType="java.lang.Integer">
    SELECT
           count(1)
    FROM
         tb_goods_spu_spec tgss
           JOIN tb_goods_spu spu ON tgss.spu_id = spu.id
           JOIN tb_goods_spec_value specValue ON tgss.spec_value_id = specValue.id
           JOIN tb_goods_spec spec ON specValue.spec_id = spec.id
           JOIN tb_goods_category category ON spu.category_id = category.id
    WHERE 1=1
      and tgss.is_delete =0
      and spu.is_delete=0
      and specValue.is_delete =0
      and spec.is_delete =0
      and category.is_delete = 0
      <if test="categoryId != null and categoryId != 0">
          and category.id = #{categoryId}
      </if>
  </select>

</mapper>